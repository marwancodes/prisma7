# Express + TypeScript + Prisma 7 Starter

A modern, production-ready starter template for building REST APIs with Express.js, TypeScript, and Prisma ORM v7.

## âœ¨ Features

- **Express 5** - Latest version with native async error handling
- **TypeScript** - Full type safety with strict mode
- **Prisma 7** - Modern ORM with driver adapters
- **ESM** - Native ES Modules support (`type: "module"`)
- **Hot Reload** - Development server with `tsx` and `nodemon`
- **PostgreSQL** - Database with `@prisma/adapter-pg`
- **Environment Variables** - Configuration with `dotenv`

## ğŸ“‹ Prerequisites

- **Node.js** v20.x LTS (recommended)
- **PostgreSQL** database
- **npm** or **yarn**

## ğŸš€ Getting Started

### 1. Clone the repository

```bash
git clone https://github.com/marwancodes/prisma7
cd prisma_starter
```

### 2. Install dependencies

```bash
npm install
```

### 3. Set up environment variables

Create a `.env` file in the root directory:

```env
DATABASE_URL="postgresql://username:password@localhost:5432/mydb"
PORT=4000
```

### 4. Set up the database

Run migrations to create the database schema:

```bash
npx prisma migrate dev --name init
```

### 5. Seed the database (optional)

Populate your database with sample data:

```bash
npx prisma db seed
```

### 6. Start the development server

```bash
npm run dev
```

The server will start at `http://localhost:4000`

## ğŸ“ Project Structure

```
prisma_starter/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ prisma.ts          # Prisma client singleton with adapter
â”‚   â”œâ”€â”€ generated/
â”‚   â”‚   â””â”€â”€ prisma/            # Generated Prisma client (auto-generated)
â”‚   â””â”€â”€ index.ts               # Express app entry point
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma          # Database schema
â”‚   â”œâ”€â”€ seed.ts                # Database seeding script
â”‚   â””â”€â”€ migrations/            # Migration history
â”œâ”€â”€ prisma.config.ts           # Prisma v7 configuration
â”œâ”€â”€ tsconfig.json              # TypeScript configuration
â”œâ”€â”€ nodemon.json               # Nodemon configuration
â””â”€â”€ package.json
```

## ğŸ› ï¸ Available Scripts

| Script | Description |
|--------|-------------|
| `npm run dev` | Start development server with hot reload |
| `npm run build` | Compile TypeScript to JavaScript |
| `npm start` | Run compiled production build |
| `npx prisma generate` | Regenerate Prisma client types |
| `npx prisma migrate dev` | Create and apply a new migration |
| `npx prisma db seed` | Seed the database with sample data |
| `npx prisma studio` | Open Prisma Studio (database GUI) |

## ğŸ—„ï¸ Database Schema

```prisma
model User {
  id          Int      @id @default(autoincrement())
  name        String
  email       String   @unique
  age         Int
  isMarried   Boolean?
  nationality String
}
```

## ğŸ”Œ API Endpoints

### Get all users

```http
GET /users
```

**Response:**

```json
{
  "id": 1,
  "name": "Marwan",
  "email": "marwan@mail.com",
  "age": 30,
  "isMarried": true,
  "nationality": "Moroccan"
}
```

## ğŸ¯ Key Implementation Details

### Prisma v7 Breaking Changes

This project uses **Prisma v7**, which introduced significant changes from v6:

1. **Driver Adapters Required** - `PrismaClient` now requires an adapter:
   ```typescript
   import { PrismaPg } from '@prisma/adapter-pg';
   import { PrismaClient } from './generated/prisma/client.js';

   const adapter = new PrismaPg({ connectionString: process.env.DATABASE_URL });
   const prisma = new PrismaClient({ adapter });
   ```

2. **Import Path Changed** - Import from generated folder, not `@prisma/client`:
   ```typescript
   // âŒ Old way (v6)
   import { PrismaClient } from '@prisma/client';

   // âœ… New way (v7)
   import { PrismaClient } from './generated/prisma/client';
   ```

3. **Configuration File** - Database URL moved to `prisma.config.ts`:
   ```typescript
   export default defineConfig({
     datasource: {
       url: env("DATABASE_URL"),
     },
   });
   ```

### ESM + TypeScript

This project uses **ES Modules** with TypeScript. Key points:

- `package.json` has `"type": "module"`
- `tsconfig.json` uses `"module": "NodeNext"` and `"moduleResolution": "NodeNext"`
- Local imports must use `.js` extensions even for `.ts` files:
  ```typescript
  import { prisma } from './lib/prisma.js'; // âœ… correct
  ```

### Development with tsx

We use **`tsx`** instead of `ts-node` for better ESM compatibility:

```json
{
  "exec": "tsx src/index.ts"
}
```

`tsx` handles TypeScript + ESM natively without loader flags or cycle errors.

## ğŸ› Common Issues

### `process is not defined`

**Solution:** Add `"types": ["node"]` to `tsconfig.json`:

```json
{
  "compilerOptions": {
    "types": ["node"]
  }
}
```

### `Cannot find module './lib/prisma.js'`

**Solution:** Ensure you're using `tsx` in `nodemon.json`, not `ts-node`:

```json
{
  "exec": "tsx src/index.ts"
}
```

### `Expected 1 arguments, but got 0` when creating PrismaClient

**Solution:** Always pass the adapter in Prisma v7:

```typescript
const adapter = new PrismaPg({ connectionString: process.env.DATABASE_URL });
const prisma = new PrismaClient({ adapter }); // âœ…
```

## ğŸ“š Learn More

- [Prisma v7 Documentation](https://www.prisma.io/docs)
- [Express 5 Documentation](https://expressjs.com/)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
- [Node.js ESM Guide](https://nodejs.org/api/esm.html)

## ğŸ“ License

MIT

## ğŸ¤ Contributing

Contributions, issues, and feature requests are welcome!

---

**Built with â¤ï¸ using Express, TypeScript, and Prisma 7**